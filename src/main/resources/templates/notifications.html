<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•Œë¦¼ ê´€ë¦¬</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; }
        .header { background: #2c3e50; color: white; padding: 20px; }
        .container { max-width: 1000px; margin: 30px auto; padding: 0 20px; }
        .card { background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn { background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #2980b9; }
        .notification { border-left: 4px solid #3498db; padding: 15px; margin: 10px 0; background: #f8f9fa; border-radius: 4px; }
        .notification.unread { background: #e3f2fd; border-left-color: #2196f3; }
        .alert-item { border-left: 4px solid #27ae60; padding: 15px; margin: 10px 0; background: #f8f9fa; border-radius: 4px; }
        .alert-item.inactive { opacity: 0.5; border-left-color: #95a5a6; }
        input, select { padding: 10px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; width: 200px; }
        .btn-danger { background: #e74c3c; }
        .btn-danger:hover { background: #c0392b; }
        .bid-item { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 4px; cursor: pointer; transition: all 0.2s; }
        .bid-item:hover { background: #f0f0f0; border-color: #667eea; }
    </style>
</head>
<body>
<div class="header">
    <h1>ğŸ”” ì•Œë¦¼ ê´€ë¦¬</h1>
    <button class="btn" onclick="location.href='/'">â† í™ˆìœ¼ë¡œ</button>
</div>

<div class="container">
    <div class="card" id="welcomeCard" style="display:none;">
        <h2 id="welcomeMessage"></h2>
    </div>

    <div class="card" id="bidListSection" style="display:none;">
        <h2>ğŸ“‹ ì…ì°° ëª©ë¡ì—ì„œ ì„ íƒ</h2>
        <p>ì•Œë¦¼ì„ ë°›ê³  ì‹¶ì€ ì…ì°° ë¬¼ê±´ì„ ì„ íƒí•˜ì„¸ìš”</p>
        <input type="text" id="searchKeyword" placeholder="ë¬¼ê±´ëª… ê²€ìƒ‰" style="width: 300px;">
        <button class="btn" onclick="searchBids()">ê²€ìƒ‰</button>
        <div id="bidList" style="max-height: 400px; overflow-y: auto; margin-top: 10px;"></div>
    </div>

    <div class="card" id="alertFormSection" style="display:none;">
        <h2>ğŸ“Œ ì•Œë¦¼ ì„¤ì •</h2>
        <p id="selectedBidInfo"></p>
        <input type="hidden" id="selectedPbctNo">
        <div style="margin: 20px 0;">
            <label>ì•Œë¦¼ íƒ€ì…:</label>
            <select id="alertType" style="width: 200px;" onchange="toggleAlertOptions()">
                <option value="DEADLINE">ë§ˆê° ì•Œë¦¼</option>
                <option value="PRICE">ê°€ê²© ë³€ë™ ì•Œë¦¼</option>
            </select>
        </div>
        <div id="deadlineOption" style="margin: 20px 0;">
            <label>ë©°ì¹  ì „ ì•Œë¦¼:</label>
            <input type="number" id="daysBefore" value="3" min="1" max="30" style="width: 100px;">ì¼ ì „
        </div>
        <div id="priceOption" style="margin: 20px 0; display: none;">
            <label>ëª©í‘œ ê°€ê²© (ì›):</label>
            <input type="number" id="targetPrice" placeholder="ì˜ˆ: 10000000" min="0" style="width: 200px;">
            <small>ì´ ê°€ê²© ì´í•˜ë¡œ ë–¨ì–´ì§€ë©´ ì•Œë¦¼</small>
        </div>
        <button class="btn" onclick="createAlert()">ì•Œë¦¼ ì„¤ì • ì¶”ê°€</button>
        <button class="btn" onclick="cancelSelection()" style="background: #95a5a6;">ì·¨ì†Œ</button>
    </div>

    <div class="card" id="alertListSection" style="display:none;">
        <h2>âš™ï¸ ë‚´ ì•Œë¦¼ ì„¤ì • ëª©ë¡</h2>
        <button class="btn" onclick="loadAlerts()">ìƒˆë¡œê³ ì¹¨</button>
        <div id="alertList"></div>
    </div>

    <div class="card" id="notificationSection" style="display:none;">
        <h2>ë‚´ ì•Œë¦¼ <span id="unreadCount"></span></h2>
        <button class="btn" onclick="loadNotifications()">ìƒˆë¡œê³ ì¹¨</button>
        <button class="btn" onclick="markAllRead()">ëª¨ë‘ ì½ìŒ</button>
        <button class="btn btn-danger" onclick="deleteAllNotifications()">ëª¨ë‘ ì‚­ì œ</button>
        <button class="btn" onclick="createTestNotification()">í…ŒìŠ¤íŠ¸ ì•Œë¦¼</button>
        <div id="notificationList"></div>
    </div>
</div>

<script>
    let token = localStorage.getItem('token');
    let username = localStorage.getItem('username');

    // âœ… code â†’ í•œê¸€ ë©”ì‹œì§€ ë§¤í•‘
    function getNotificationMessageByCode(code) {
        switch (code) {
            case 'AUTH_REQUIRED': return 'ğŸ”‘ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.';
            case 'NOTIFICATION_LIST_ERROR': return 'âŒ ì•Œë¦¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            case 'UNREAD_LIST_OK': return 'âœ… ì½ì§€ ì•Šì€ ì•Œë¦¼ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.';
            case 'UNREAD_LIST_ERROR': return 'âŒ ì½ì§€ ì•Šì€ ì•Œë¦¼ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            case 'NOTIFICATION_READ_SUCCESS': return 'âœ… ì•Œë¦¼ì„ ì½ìŒ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤.';
            case 'NOTIFICATION_READ_ERROR': return 'âŒ ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            case 'NOTIFICATION_READ_ALL_SUCCESS': return 'âœ… ëª¨ë“  ì•Œë¦¼ì„ ì½ìŒ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤.';
            case 'NOTIFICATION_READ_ALL_ERROR': return 'âŒ ëª¨ë“  ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            case 'ALERT_CREATE_SUCCESS': return 'âœ… ì•Œë¦¼ ì„¤ì •ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.';
            case 'ALERT_CREATE_ERROR': return 'âŒ ì•Œë¦¼ ì„¤ì • ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            case 'ALERT_LIST_ERROR': return 'âŒ ì•Œë¦¼ ì„¤ì • ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            case 'ALERT_UPDATE_SUCCESS': return 'âœ… ì•Œë¦¼ ì„¤ì •ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.';
            case 'ALERT_UPDATE_ERROR': return 'âŒ ì•Œë¦¼ ì„¤ì • ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            case 'ALERT_DELETE_SUCCESS': return 'âœ… ì•Œë¦¼ ì„¤ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.';
            case 'ALERT_DELETE_ERROR': return 'âŒ ì•Œë¦¼ ì„¤ì • ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            case 'NOTIFICATION_DELETE_SUCCESS': return 'âœ… ì•Œë¦¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.';
            case 'NOTIFICATION_DELETE_ERROR': return 'âŒ ì•Œë¦¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            case 'NOTIFICATION_DELETE_ALL_SUCCESS': return 'âœ… ëª¨ë“  ì•Œë¦¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.';
            case 'NOTIFICATION_DELETE_ALL_ERROR': return 'âŒ ëª¨ë“  ì•Œë¦¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            case 'TEST_NOTIFICATION_CREATED': return 'âœ… í…ŒìŠ¤íŠ¸ ì•Œë¦¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.';
            case 'TEST_NOTIFICATION_ERROR': return 'âŒ í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            default: return 'âŒ ì•Œ ìˆ˜ ì—†ëŠ” ì‘ë‹µì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
        }
    }

    function checkLogin() {
        if (!token || !username) {
            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            location.href = '/login';
            return false;
        }
        return true;
    }

    function initPage() {
        if (!checkLogin()) return;

        document.getElementById('welcomeCard').style.display = 'block';
        document.getElementById('welcomeMessage').textContent = `${username} íšŒì›ë‹˜, ì•Œë¦¼ ì„¤ì • í™”ë©´ì…ë‹ˆë‹¤.`;
        document.getElementById('bidListSection').style.display = 'block';
        document.getElementById('alertListSection').style.display = 'block';
        document.getElementById('notificationSection').style.display = 'block';

        loadNotifications();
        loadAlerts();
        searchBids();
    }

    function searchBids() {
        const keyword = document.getElementById('searchKeyword').value;
        const url = keyword ?
            `/api/bids-from-db?numOfRows=20&cltrNm=${keyword}` :
            `/api/bids-from-db?numOfRows=20`;

        fetch(url)
            .then(res => res.json())
            .then(data => {
                const list = document.getElementById('bidList');
                if (!Array.isArray(data) || data.length === 0) {
                    list.innerHTML = '<p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }
                list.innerHTML = data.map(bid => `
                    <div class="bid-item" onclick="selectBid('${bid.pbctNo}', '${bid.cltrNm}')">
                        <strong>ğŸ  ${bid.cltrNm || 'ë¬¼ê±´ëª… ì—†ìŒ'}</strong><br>
                        <small>ê³µê³ ë²ˆí˜¸: ${bid.pbctNo}</small><br>
                        <small>ìµœì €ê°€: ${(bid.minBidPrc || 0).toLocaleString()}ì›</small><br>
                        <small>ë§ˆê°: ${bid.pbctEndDt || 'ë¯¸ì •'}</small>
                    </div>
                `).join('');
            })
            .catch(() => alert('ì…ì°° ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨'));
    }

    function selectBid(pbctNo, cltrNm) {
        document.getElementById('selectedPbctNo').value = pbctNo;
        document.getElementById('selectedBidInfo').innerHTML = `
            <strong>ì„ íƒí•œ ë¬¼ê±´:</strong> ${cltrNm}<br>
            <strong>ê³µê³ ë²ˆí˜¸:</strong> ${pbctNo}
        `;
        document.getElementById('alertFormSection').style.display = 'block';
        document.getElementById('alertFormSection').scrollIntoView({ behavior: 'smooth' });
    }

    function cancelSelection() {
        document.getElementById('alertFormSection').style.display = 'none';
        document.getElementById('selectedPbctNo').value = '';
    }

    function toggleAlertOptions() {
        const alertType = document.getElementById('alertType').value;
        if (alertType === 'DEADLINE') {
            document.getElementById('deadlineOption').style.display = 'block';
            document.getElementById('priceOption').style.display = 'none';
        } else if (alertType === 'PRICE') {
            document.getElementById('deadlineOption').style.display = 'none';
            document.getElementById('priceOption').style.display = 'block';
        }
    }

    function createAlert() {
        const pbctNo = document.getElementById('selectedPbctNo').value;
        if (!pbctNo) {
            alert('ì…ì°° ë¬¼ê±´ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
            return;
        }

        const alertType = document.getElementById('alertType').value;
        const alertData = {
            pbctNo: pbctNo,
            alertType: alertType,
            isActive: true
        };

        if (alertType === 'DEADLINE') {
            alertData.alertDaysBefore = document.getElementById('daysBefore').value;
        } else if (alertType === 'PRICE') {
            const targetPrice = document.getElementById('targetPrice').value;
            if (!targetPrice || targetPrice <= 0) {
                alert('ëª©í‘œ ê°€ê²©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            alertData.targetPrice = targetPrice;
        }

        fetch('/api/notifications/alerts', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify(alertData)
        })
            .then(async res => {
                const data = await res.json().catch(() => null);
                if (!res.ok || (data && data.success === false)) {
                    const code = data && data.code ? data.code : 'ALERT_CREATE_ERROR';
                    const msg = getNotificationMessageByCode(code);
                    if (res.status === 401 || code === 'AUTH_REQUIRED') {
                        alert(msg);
                        location.href = '/login';
                        return;
                    }
                    alert(msg);
                    return;
                }
                const code = data && data.code ? data.code : 'ALERT_CREATE_SUCCESS';
                alert(getNotificationMessageByCode(code));
                cancelSelection();
                loadAlerts();
            })
            .catch(() => alert(getNotificationMessageByCode('ALERT_CREATE_ERROR')));
    }

    function loadNotifications() {
        // ì „ì²´ ì•Œë¦¼ ëª©ë¡
        fetch('/api/notifications', {
            headers: {'Authorization': 'Bearer ' + token}
        })
            .then(async res => {
                const data = await res.json().catch(() => null);
                if (!res.ok) {
                    const code = data && data.code ? data.code : 'NOTIFICATION_LIST_ERROR';
                    const msg = getNotificationMessageByCode(code);
                    if (res.status === 401 || code === 'AUTH_REQUIRED') {
                        alert(msg);
                        location.href = '/login';
                        return;
                    }
                    alert(msg);
                    return;
                }

                const list = document.getElementById('notificationList');
                const notifications = Array.isArray(data) ? data : [];
                if (notifications.length === 0) {
                    list.innerHTML = '<p>ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }

                list.innerHTML = notifications.map(n => `
                <div class="notification ${n.isRead ? '' : 'unread'}">
                    <strong>${n.notificationType}</strong>: ${n.message}
                    <br><small>${n.createdAt}</small><br>
                    ${!n.isRead ? `<button class="btn" onclick="markRead(${n.notificationId})">ì½ìŒ</button>` : ''}
                    <button class="btn btn-danger" onclick="deleteNotification(${n.notificationId})">ì‚­ì œ</button>
                </div>
            `).join('');
            });

        // ë¯¸ì½ìŒ ê°œìˆ˜
        fetch('/api/notifications/unread', {
            headers: {'Authorization': 'Bearer ' + token}
        })
            .then(async res => {
                const data = await res.json().catch(() => null);
                if (!res.ok || (data && data.success === false)) {
                    const code = data && data.code ? data.code : 'UNREAD_LIST_ERROR';
                    const msg = getNotificationMessageByCode(code);
                    if (res.status === 401 || code === 'AUTH_REQUIRED') {
                        alert(msg);
                        location.href = '/login';
                        return;
                    }
                    // ê°œìˆ˜ ì¶œë ¥ë§Œ ì‹¤íŒ¨í•œ ê±´ ì¡°ìš©íˆ ë¬´ì‹œí•´ë„ ë¨
                    return;
                }
                const count = data.count ?? 0;
                document.getElementById('unreadCount').textContent = `(${count}ê°œ)`;
            });
    }

    function markRead(id) {
        fetch(`/api/notifications/${id}/read`, {
            method: 'PUT',
            headers: {'Authorization': 'Bearer ' + token}
        })
            .then(async res => {
                const data = await res.json().catch(() => null);
                if (!res.ok || (data && data.success === false)) {
                    const code = data && data.code ? data.code : 'NOTIFICATION_READ_ERROR';
                    const msg = getNotificationMessageByCode(code);
                    if (res.status === 401 || code === 'AUTH_REQUIRED') {
                        alert(msg);
                        location.href = '/login';
                        return;
                    }
                    alert(msg);
                    return;
                }
                alert(getNotificationMessageByCode('NOTIFICATION_READ_SUCCESS'));
                loadNotifications();
            });
    }

    function markAllRead() {
        if (!confirm('ëª¨ë“  ì•Œë¦¼ì„ ì½ìŒ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

        fetch('/api/notifications/read-all', {
            method: 'PUT',
            headers: {'Authorization': 'Bearer ' + token}
        })
            .then(async res => {
                const data = await res.json().catch(() => null);
                if (!res.ok || (data && data.success === false)) {
                    const code = data && data.code ? data.code : 'NOTIFICATION_READ_ALL_ERROR';
                    const msg = getNotificationMessageByCode(code);
                    if (res.status === 401 || code === 'AUTH_REQUIRED') {
                        alert(msg);
                        location.href = '/login';
                        return;
                    }
                    alert(msg);
                    return;
                }
                alert(getNotificationMessageByCode('NOTIFICATION_READ_ALL_SUCCESS'));
                loadNotifications();
            });
    }

    function createTestNotification() {
        fetch('/api/notifications/test', {
            headers: {'Authorization': 'Bearer ' + token}
        })
            .then(async res => {
                const data = await res.json().catch(() => null);
                if (!res.ok || (data && data.success === false)) {
                    const code = data && data.code ? data.code : 'TEST_NOTIFICATION_ERROR';
                    alert(getNotificationMessageByCode(code));
                    return;
                }
                const code = data && data.code ? data.code : 'TEST_NOTIFICATION_CREATED';
                alert(getNotificationMessageByCode(code));
                loadNotifications();
            });
    }

    function loadAlerts() {
        fetch('/api/notifications/alerts', {
            headers: {'Authorization': 'Bearer ' + token}
        })
            .then(async res => {
                const data = await res.json().catch(() => null);
                const list = document.getElementById('alertList');

                if (!res.ok) {
                    const code = data && data.code ? data.code : 'ALERT_LIST_ERROR';
                    const msg = getNotificationMessageByCode(code);
                    if (res.status === 401 || code === 'AUTH_REQUIRED') {
                        alert(msg);
                        location.href = '/login';
                        return;
                    }
                    list.innerHTML = '<p>ì•Œë¦¼ ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
                    return;
                }

                const alerts = Array.isArray(data) ? data : [];
                if (alerts.length === 0) {
                    list.innerHTML = '<p>ì„¤ì •ëœ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }

                list.innerHTML = alerts.map(alert => {
                    let detailInfo = '';
                    if (alert.alertType === 'DEADLINE') {
                        detailInfo = `<strong>ë©°ì¹  ì „:</strong> ${alert.alertDaysBefore}ì¼`;
                    } else if (alert.alertType === 'PRICE') {
                        detailInfo = `<strong>ëª©í‘œ ê°€ê²©:</strong> ${(alert.targetPrice || 0).toLocaleString()}ì›`;
                    }
                    return `
                    <div class="alert-item ${alert.isActive ? '' : 'inactive'}">
                        <strong>ê³µê³ ë²ˆí˜¸:</strong> ${alert.pbctNo || 'ì „ì²´'}<br>
                        <strong>ì•Œë¦¼ íƒ€ì…:</strong> ${alert.alertType === 'DEADLINE' ? 'ë§ˆê° ì•Œë¦¼' : 'ê°€ê²© ë³€ë™ ì•Œë¦¼'}<br>
                        ${detailInfo}<br>
                        <strong>ìƒíƒœ:</strong> ${alert.isActive ? 'í™œì„±' : 'ë¹„í™œì„±'}<br>
                        <small>ìƒì„±ì¼: ${alert.createdAt}</small><br>
                        <button class="btn btn-danger" onclick="deleteAlert(${alert.alertId})">ì‚­ì œ</button>
                    </div>
                `;
                }).join('');
            });
    }

    function deleteAlert(alertId) {
        if (!confirm('ì´ ì•Œë¦¼ ì„¤ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

        fetch(`/api/notifications/alerts/${alertId}`, {
            method: 'DELETE',
            headers: {'Authorization': 'Bearer ' + token}
        })
            .then(async res => {
                const data = await res.json().catch(() => null);
                if (!res.ok || (data && data.success === false)) {
                    const code = data && data.code ? data.code : 'ALERT_DELETE_ERROR';
                    const msg = getNotificationMessageByCode(code);
                    if (res.status === 401 || code === 'AUTH_REQUIRED') {
                        alert(msg);
                        location.href = '/login';
                        return;
                    }
                    alert(msg);
                    return;
                }
                alert(getNotificationMessageByCode('ALERT_DELETE_SUCCESS'));
                loadAlerts();
            });
    }

    function deleteNotification(notificationId) {
        if (!confirm('ì´ ì•Œë¦¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

        fetch(`/api/notifications/${notificationId}`, {
            method: 'DELETE',
            headers: {'Authorization': 'Bearer ' + token}
        })
            .then(async res => {
                const data = await res.json().catch(() => null);
                if (!res.ok || (data && data.success === false)) {
                    const code = data && data.code ? data.code : 'NOTIFICATION_DELETE_ERROR';
                    const msg = getNotificationMessageByCode(code);
                    if (res.status === 401 || code === 'AUTH_REQUIRED') {
                        alert(msg);
                        location.href = '/login';
                        return;
                    }
                    alert(msg);
                    return;
                }
                alert(getNotificationMessageByCode('NOTIFICATION_DELETE_SUCCESS'));
                loadNotifications();
            });
    }

    function deleteAllNotifications() {
        if (!confirm('ëª¨ë“  ì•Œë¦¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

        fetch('/api/notifications/delete-all', {
            method: 'DELETE',
            headers: {'Authorization': 'Bearer ' + token}
        })
            .then(async res => {
                const data = await res.json().catch(() => null);
                if (!res.ok || (data && data.success === false)) {
                    const code = data && data.code ? data.code : 'NOTIFICATION_DELETE_ALL_ERROR';
                    const msg = getNotificationMessageByCode(code);
                    if (res.status === 401 || code === 'AUTH_REQUIRED') {
                        alert(msg);
                        location.href = '/login';
                        return;
                    }
                    alert(msg);
                    return;
                }
                alert(getNotificationMessageByCode('NOTIFICATION_DELETE_ALL_SUCCESS'));
                loadNotifications();
            });
    }

    initPage();
</script>
</body>
</html>
